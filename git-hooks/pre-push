#!/usr/bin/env bash
# git-hooks/pre-push

echo "Ejecutando verificaciones rápidas de pre-push..."

# 1) Ejecutar verificaciones rápidas de políticas en Python
PYTHONPATH=. python scripts/check_policies.py infra/terraform || echo "política: se detectaron hallazgos (bloqueará en CI si son de tipo High)"

# 2) Verificación básica de terraform fmt
if command -v terraform >/dev/null 2>&1; then
  (cd infra/terraform && terraform fmt -check) || { echo "terraform fmt falló"; exit 1; }
else
  echo "terraform no está instalado; omitiendo verificación de terraform fmt"
fi

# Si quieres que no bloquee, usa exit 0; para bloquear, usa exit 1 en fallas
exit 0
